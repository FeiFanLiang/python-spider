const parse = require('@babel/parser').parse
const traverse = require('@babel/traverse').default
const generate = require('@babel/generator').default
const t = require('@babel/types')
const fs = require('fs')

const js = fs.readFileSync('./3.js','utf-8')

var $a = ['\x41\x63\x4b\x4e\x48\x41\x3d\x3d', '\x4e\x32\x6b\x4f', '\x4c\x38\x4b\x6f\x77\x34\x38\x3d', '\x77\x71\x41\x5a\x77\x36\x4d\x3d', '\x58\x79\x52\x4c', '\x77\x71\x33\x43\x68\x42\x6b\x3d', '\x64\x63\x4b\x41\x46\x77\x3d\x3d', '\x77\x70\x67\x4f\x77\x6f\x73\x3d', '\x77\x34\x78\x35\x53\x67\x3d\x3d', '\x52\x54\x49\x30', '\x77\x70\x44\x44\x71\x48\x59\x3d', '\x57\x67\x72\x44\x68\x67\x3d\x3d', '\x4b\x38\x4f\x43\x49\x51\x3d\x3d', '\x5a\x78\x6c\x39', '\x47\x6d\x33\x44\x69\x41\x3d\x3d', '\x58\x30\x48\x43\x74\x41\x3d\x3d', '\x77\x35\x78\x76\x58\x51\x3d\x3d', '\x58\x51\x78\x4b', '\x77\x34\x59\x79\x4c\x77\x3d\x3d', '\x66\x41\x37\x44\x76\x77\x3d\x3d', '\x61\x4d\x4b\x78\x77\x34\x6f\x3d', '\x42\x30\x44\x43\x6e\x77\x3d\x3d', '\x4d\x78\x54\x44\x6b\x67\x3d\x3d', '\x54\x6b\x77\x6a', '\x77\x37\x56\x63\x77\x37\x41\x3d', '\x77\x35\x68\x44\x77\x70\x49\x3d', '\x77\x71\x4e\x56\x77\x37\x34\x3d', '\x66\x77\x48\x44\x6a\x51\x3d\x3d', '\x77\x37\x64\x68\x46\x77\x3d\x3d', '\x77\x36\x4c\x43\x76\x78\x38\x3d', '\x59\x6a\x6e\x44\x71\x41\x3d\x3d', '\x52\x45\x2f\x43\x73\x41\x3d\x3d', '\x77\x72\x6a\x44\x72\x38\x4b\x47', '\x56\x63\x4f\x35\x77\x36\x38\x3d', '\x46\x53\x7a\x44\x6e\x51\x3d\x3d', '\x4c\x38\x4f\x77\x47\x41\x3d\x3d', '\x65\x51\x4a\x61', '\x54\x41\x37\x44\x6a\x77\x3d\x3d', '\x77\x6f\x35\x48\x77\x37\x77\x3d', '\x77\x34\x33\x43\x73\x44\x51\x3d', '\x4d\x54\x77\x2b', '\x51\x69\x52\x46', '\x4a\x48\x62\x43\x72\x67\x3d\x3d', '\x4c\x52\x38\x42', '\x55\x48\x58\x43\x6a\x77\x3d\x3d', '\x77\x6f\x6a\x43\x6e\x79\x38\x3d', '\x52\x38\x4b\x74\x77\x34\x49\x3d', '\x77\x36\x6e\x43\x75\x7a\x4d\x3d', '\x77\x36\x34\x4f\x77\x34\x34\x3d', '\x44\x53\x7a\x44\x6a\x41\x3d\x3d', '\x77\x35\x63\x37\x77\x34\x77\x3d', '\x77\x6f\x4e\x30\x66\x67\x3d\x3d', '\x66\x42\x4e\x48', '\x77\x72\x31\x70\x77\x35\x51\x3d', '\x77\x70\x77\x5a\x77\x35\x45\x3d', '\x59\x53\x76\x44\x69\x77\x3d\x3d', '\x58\x78\x33\x44\x68\x41\x3d\x3d', '\x43\x63\x4f\x45\x49\x67\x3d\x3d', '\x66\x69\x6e\x44\x6a\x41\x3d\x3d', '\x77\x70\x45\x69\x64\x51\x3d\x3d', '\x5a\x41\x37\x44\x73\x51\x3d\x3d', '\x77\x37\x59\x67\x77\x34\x67\x3d', '\x65\x53\x42\x37', '\x77\x71\x42\x68\x77\x34\x49\x3d', '\x77\x37\x34\x4b\x77\x37\x51\x3d', '\x66\x56\x48\x43\x71\x67\x3d\x3d', '\x77\x71\x31\x6f\x46\x41\x3d\x3d', '\x77\x36\x48\x44\x74\x73\x4f\x62', '\x52\x63\x4f\x64\x77\x70\x63\x3d', '\x77\x6f\x6c\x30\x66\x67\x3d\x3d', '\x77\x70\x45\x38\x77\x70\x51\x3d', '\x77\x37\x66\x43\x73\x43\x6b\x3d', '\x61\x55\x48\x43\x67\x41\x3d\x3d', '\x4c\x4d\x4f\x43\x4b\x51\x3d\x3d', '\x77\x36\x46\x48\x77\x35\x30\x3d', '\x64\x73\x4b\x65\x77\x36\x41\x3d', '\x77\x72\x55\x37\x77\x6f\x6b\x3d', '\x77\x6f\x33\x44\x75\x45\x6b\x3d', '\x77\x71\x64\x4b\x77\x35\x38\x3d', '\x77\x71\x67\x66\x53\x51\x3d\x3d', '\x63\x38\x4f\x58\x77\x35\x6f\x3d', '\x65\x63\x4f\x75\x77\x34\x59\x3d', '\x35\x35\x2b\x38\x37\x37\x79\x62\x35\x4c\x36\x52', '\x5a\x41\x64\x6e', '\x77\x36\x54\x43\x6e\x69\x34\x3d', '\x46\x78\x63\x4d', '\x77\x35\x39\x79\x5a\x41\x3d\x3d', '\x5a\x73\x4f\x78\x77\x72\x41\x3d', '\x77\x70\x67\x43\x52\x77\x3d\x3d', '\x65\x7a\x56\x47', '\x54\x44\x54\x44\x73\x51\x3d\x3d', '\x77\x6f\x6e\x44\x6a\x6e\x63\x3d', '\x62\x6d\x59\x65', '\x5a\x33\x48\x43\x70\x51\x3d\x3d', '\x77\x37\x63\x4a\x77\x36\x6f\x3d', '\x43\x63\x4b\x51\x48\x67\x3d\x3d', '\x77\x6f\x76\x44\x76\x56\x41\x3d', '\x62\x48\x76\x43\x76\x41\x3d\x3d', '\x77\x35\x5a\x58\x77\x37\x49\x3d', '\x54\x53\x51\x70', '\x77\x6f\x54\x44\x71\x6c\x6b\x3d', '\x58\x44\x44\x44\x6f\x67\x3d\x3d', '\x51\x48\x62\x43\x6b\x51\x3d\x3d', '\x64\x48\x50\x43\x72\x41\x3d\x3d', '\x77\x37\x6f\x37\x77\x35\x6f\x3d', '\x58\x44\x31\x74', '\x48\x32\x6a\x43\x71\x51\x3d\x3d', '\x77\x34\x6f\x68\x4c\x51\x3d\x3d', '\x42\x73\x4f\x75\x4f\x51\x3d\x3d', '\x56\x45\x44\x43\x76\x67\x3d\x3d', '\x77\x6f\x35\x41\x77\x37\x55\x3d', '\x61\x73\x4f\x50\x77\x6f\x77\x3d', '\x4f\x48\x58\x43\x70\x67\x3d\x3d', '\x77\x35\x74\x52\x48\x51\x3d\x3d', '\x77\x34\x35\x6c\x77\x35\x59\x3d', '\x77\x71\x42\x44\x46\x67\x3d\x3d', '\x77\x71\x56\x65\x77\x72\x51\x3d', '\x77\x36\x6b\x51\x4a\x41\x3d\x3d', '\x77\x72\x34\x6f\x77\x34\x73\x3d', '\x5a\x47\x58\x43\x71\x67\x3d\x3d', '\x77\x36\x6e\x44\x74\x73\x4f\x30', '\x61\x63\x4f\x5a\x77\x70\x34\x3d', '\x64\x73\x4b\x58\x50\x77\x3d\x3d', '\x4d\x69\x48\x44\x72\x41\x3d\x3d', '\x66\x47\x7a\x43\x76\x51\x3d\x3d', '\x77\x36\x38\x41\x4d\x51\x3d\x3d', '\x52\x47\x62\x44\x6e\x67\x3d\x3d', '\x77\x72\x51\x51\x54\x51\x3d\x3d', '\x48\x4d\x4f\x75\x47\x51\x3d\x3d', '\x65\x55\x58\x43\x6b\x77\x3d\x3d', '\x56\x48\x4c\x43\x73\x67\x3d\x3d', '\x77\x36\x72\x44\x70\x63\x4f\x45', '\x51\x48\x37\x43\x6b\x51\x3d\x3d', '\x62\x73\x4f\x6f\x63\x67\x3d\x3d', '\x62\x31\x62\x43\x6f\x67\x3d\x3d', '\x77\x72\x45\x6c\x77\x37\x59\x3d', '\x65\x33\x33\x43\x6d\x51\x3d\x3d', '\x4c\x6d\x7a\x44\x72\x51\x3d\x3d', '\x4f\x42\x66\x44\x73\x67\x3d\x3d', '\x77\x36\x39\x33\x55\x67\x3d\x3d', '\x77\x70\x70\x64\x77\x36\x63\x3d', '\x49\x57\x76\x43\x72\x41\x3d\x3d', '\x61\x56\x33\x43\x69\x41\x3d\x3d', '\x48\x63\x4f\x50\x4f\x77\x3d\x3d', '\x77\x34\x48\x44\x70\x4d\x4f\x73', '\x42\x44\x6e\x44\x76\x51\x3d\x3d', '\x49\x38\x4f\x72\x77\x6f\x4d\x3d', '\x56\x56\x72\x43\x73\x77\x3d\x3d', '\x4d\x63\x4f\x50\x46\x41\x3d\x3d', '\x77\x72\x42\x69\x77\x71\x30\x3d', '\x55\x45\x4c\x43\x72\x41\x3d\x3d', '\x42\x32\x72\x43\x68\x67\x3d\x3d', '\x50\x63\x4b\x35\x49\x51\x3d\x3d', '\x44\x38\x4f\x41\x45\x41\x3d\x3d', '\x48\x51\x2f\x44\x6d\x41\x3d\x3d', '\x77\x6f\x44\x44\x6d\x47\x41\x3d', '\x77\x71\x67\x39\x66\x41\x3d\x3d', '\x77\x34\x45\x68\x42\x41\x3d\x3d', '\x43\x38\x4b\x71\x47\x41\x3d\x3d', '\x77\x71\x72\x43\x71\x7a\x77\x3d', '\x77\x36\x4c\x44\x70\x63\x4f\x30', '\x77\x72\x49\x54\x77\x36\x34\x3d', '\x77\x35\x6b\x66\x4f\x77\x3d\x3d', '\x47\x6e\x37\x43\x68\x67\x3d\x3d', '\x63\x78\x37\x43\x74\x77\x3d\x3d', '\x4e\x63\x4b\x4a\x41\x51\x3d\x3d', '\x54\x45\x50\x43\x76\x51\x3d\x3d', '\x45\x44\x41\x5a', '\x77\x71\x6b\x48\x77\x34\x45\x3d', '\x77\x72\x74\x7a\x58\x77\x3d\x3d', '\x57\x32\x76\x43\x6e\x41\x3d\x3d', '\x77\x71\x34\x67\x77\x34\x38\x3d', '\x42\x63\x4f\x41\x49\x67\x3d\x3d', '\x35\x62\x32\x6a\x52\x30\x6f\x3d', '\x62\x41\x7a\x44\x74\x67\x3d\x3d', '\x77\x36\x6c\x69\x64\x51\x3d\x3d', '\x77\x36\x4e\x53\x55\x51\x3d\x3d', '\x47\x48\x2f\x43\x68\x41\x3d\x3d', '\x66\x38\x4b\x48\x77\x35\x51\x3d', '\x77\x36\x31\x55\x53\x77\x3d\x3d', '\x77\x35\x6f\x4b\x4a\x41\x3d\x3d', '\x77\x70\x55\x61\x77\x35\x63\x3d', '\x4b\x46\x72\x43\x75\x77\x3d\x3d', '\x4b\x53\x58\x44\x75\x77\x3d\x3d', '\x62\x30\x7a\x43\x6b\x51\x3d\x3d', '\x4a\x6a\x41\x5a', '\x43\x38\x4f\x53\x42\x41\x3d\x3d', '\x77\x6f\x67\x53\x62\x41\x3d\x3d', '\x35\x62\x79\x44\x48\x73\x4f\x56', '\x64\x42\x68\x67', '\x49\x4d\x4b\x74\x4c\x77\x3d\x3d', '\x77\x36\x6c\x76\x57\x41\x3d\x3d', '\x77\x70\x62\x44\x72\x7a\x49\x3d', '\x77\x71\x30\x2f\x77\x37\x63\x3d', '\x45\x54\x6f\x2f', '\x77\x70\x6f\x47\x77\x35\x55\x3d', '\x77\x70\x34\x43\x77\x35\x38\x3d', '\x64\x38\x4b\x4b\x4c\x67\x3d\x3d', '\x65\x73\x4b\x77\x4c\x77\x3d\x3d', '\x77\x6f\x77\x46\x77\x37\x73\x3d', '\x77\x36\x67\x4b\x77\x35\x59\x3d', '\x4f\x42\x6f\x74', '\x53\x52\x4e\x43', '\x58\x38\x4b\x37\x44\x77\x3d\x3d', '\x77\x70\x74\x6a\x65\x67\x3d\x3d', '\x52\x42\x39\x71', '\x77\x72\x63\x63\x77\x6f\x51\x3d', '\x35\x35\x36\x46\x37\x37\x36\x36\x35\x4c\x79\x30', '\x77\x37\x45\x45\x77\x72\x49\x3d', '\x77\x70\x48\x43\x69\x7a\x49\x3d', '\x52\x56\x30\x32', '\x77\x72\x63\x69\x77\x36\x6f\x3d', '\x55\x78\x62\x44\x6e\x51\x3d\x3d', '\x77\x6f\x6c\x79\x56\x51\x3d\x3d', '\x77\x37\x52\x4e\x50\x41\x3d\x3d', '\x77\x37\x45\x52\x4d\x41\x3d\x3d', '\x50\x32\x58\x43\x69\x41\x3d\x3d', '\x77\x72\x41\x79\x77\x37\x55\x3d', '\x77\x6f\x6f\x4a\x77\x34\x51\x3d', '\x4f\x47\x33\x43\x73\x77\x3d\x3d', '\x77\x35\x39\x6e\x55\x67\x3d\x3d', '\x41\x38\x4b\x77\x43\x51\x3d\x3d', '\x77\x34\x4c\x43\x72\x7a\x30\x3d', '\x77\x70\x63\x74\x77\x34\x51\x3d', '\x77\x35\x49\x2b\x4e\x77\x3d\x3d', '\x77\x34\x46\x62\x4f\x67\x3d\x3d', '\x77\x36\x50\x43\x72\x44\x49\x3d', '\x77\x70\x6c\x2f\x77\x34\x59\x3d', '\x58\x55\x45\x57', '\x4b\x6a\x45\x4b', '\x77\x37\x68\x35\x63\x51\x3d\x3d', '\x77\x70\x4d\x54\x51\x51\x3d\x3d', '\x61\x73\x4b\x76\x77\x34\x30\x3d', '\x4e\x48\x76\x44\x67\x77\x3d\x3d', '\x54\x6d\x67\x37', '\x77\x6f\x74\x6a\x77\x6f\x45\x3d', '\x77\x6f\x4a\x41\x4d\x67\x3d\x3d', '\x62\x73\x4f\x66\x77\x70\x55\x3d', '\x77\x35\x78\x6c\x49\x77\x3d\x3d', '\x5a\x58\x76\x43\x6b\x51\x3d\x3d', '\x42\x67\x77\x58', '\x77\x34\x31\x77\x41\x77\x3d\x3d', '\x57\x4d\x4b\x4c\x77\x37\x41\x3d', '\x4b\x69\x54\x44\x69\x77\x3d\x3d', '\x77\x36\x4a\x71\x50\x51\x3d\x3d', '\x4c\x45\x50\x43\x70\x77\x3d\x3d', '\x77\x72\x6c\x4d\x4f\x67\x3d\x3d', '\x51\x63\x4b\x56\x4c\x77\x3d\x3d', '\x77\x6f\x34\x34\x46\x77\x3d\x3d', '\x77\x35\x6c\x55\x77\x36\x55\x3d', '\x54\x73\x4f\x33\x77\x72\x4d\x3d', '\x77\x6f\x50\x44\x73\x67\x45\x3d', '\x47\x55\x33\x43\x6e\x77\x3d\x3d', '\x5a\x68\x6c\x41', '\x77\x70\x41\x68\x44\x51\x3d\x3d', '\x77\x6f\x4d\x78\x47\x77\x3d\x3d', '\x77\x34\x6f\x54\x77\x37\x4d\x3d', '\x35\x4c\x69\x75\x35\x35\x53\x57\x36\x49\x71\x51', '\x77\x35\x70\x70\x77\x34\x34\x3d', '\x77\x6f\x37\x44\x74\x32\x51\x3d', '\x77\x6f\x39\x77\x54\x41\x3d\x3d', '\x61\x52\x68\x69'];
    (function(a, b) {
        var c = function(g) {
            while (--g) {
                a['push'](a['shift']());
            }
        };
        var f = function() {
            var g = {
                'data': {
                    'key': 'cookie',
                    'value': 'timeout'
                },
                'setCookie': function(k, l, m, n) {
                    n = n || {};
                    var o = l + '=' + m;
                    var p = 0x0;
                    for (var q = 0x0, r = k['length']; q < r; q++) {
                        var s = k[q];
                        o += ';\x20' + s;
                        var t = k[s];
                        k['push'](t);
                        r = k['length'];
                        if (t !== !![]) {
                            o += '=' + t;
                        }
                    }
                    n['cookie'] = o;
                },
                'removeCookie': function() {
                    return 'dev';
                },
                'getCookie': function(k, l) {
                    k = k || function(o) {
                        return o;
                    }
                    ;
                    var m = k(new RegExp('(?:^|;\x20)' + l['replace'](/([.$?*|{}()[]\/+^])/g, '$1') + '=([^;]*)'));
                    var n = function(o, p) {
                        o(++p);
                    };
                    n(c, b);
                    return m ? decodeURIComponent(m[0x1]) : undefined;
                }
            };
            var h = function() {
                var k = new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');
                return true
            };
            g['updateCookie'] = h;
            var i = '';
            var j = g['updateCookie']();
            if (!j) {
                g['setCookie'](['*'], 'counter', 0x1);
            } else if (j) {
                i = g['getCookie'](null, 'counter');
            } else {
                g['removeCookie']();
            }
        };
        f();
    }($a, 0x196));
    var $b = function(a, b) {
        a = a - 0x0;
        var c = $a[a];
        if ($b['wDwjlX'] === undefined) {
            (function() {
                var f;
                try {
                    var h = Function('return\x20(function()\x20' + '{}.constructor(\x22return\x20this\x22)(\x20)' + ');');
                    f = h();
                } catch (i) {
                    f = window;
                }
                var g = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
                f['atob'] || (f['atob'] = function(j) {
                    var k = String(j)['replace'](/=+$/, '');
                    var l = '';
                    for (var m = 0x0, n, o, p = 0x0; o = k['charAt'](p++); ~o && (n = m % 0x4 ? n * 0x40 + o : o,
                    m++ % 0x4) ? l += String['fromCharCode'](0xff & n >> (-0x2 * m & 0x6)) : 0x0) {
                        o = g['indexOf'](o);
                    }
                    return l;
                }
                );
            }());
            var e = function(f, g) {
                var h = [], l = 0x0, m, n = '', o = '';
                f = atob(f);
                for (var q = 0x0, r = f['length']; q < r; q++) {
                    o += '%' + ('00' + f['charCodeAt'](q)['toString'](0x10))['slice'](-0x2);
                }
                f = decodeURIComponent(o);
                var p;
                for (p = 0x0; p < 0x100; p++) {
                    h[p] = p;
                }
                for (p = 0x0; p < 0x100; p++) {
                    l = (l + h[p] + g['charCodeAt'](p % g['length'])) % 0x100;
                    m = h[p];
                    h[p] = h[l];
                    h[l] = m;
                }
                p = 0x0;
                l = 0x0;
                for (var t = 0x0; t < f['length']; t++) {
                    p = (p + 0x1) % 0x100;
                    l = (l + h[p]) % 0x100;
                    m = h[p];
                    h[p] = h[l];
                    h[l] = m;
                    n += String['fromCharCode'](f['charCodeAt'](t) ^ h[(h[p] + h[l]) % 0x100]);
                }
                return n;
            };
            $b['mJVCif'] = e;
            $b['zBqGxm'] = {};
            $b['wDwjlX'] = !![];
        }
        var d = $b['zBqGxm'][a];
        if (d === undefined) {
            if ($b['YQUlli'] === undefined) {
                var f = function(g) {
                    this['untziS'] = g;
                    this['vYZdFk'] = [0x1, 0x0, 0x0];
                    this['pTPNsg'] = function() {
                        return 'newState';
                    }
                    ;
                    this['OvqEvs'] = '\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';
                    this['UUyTaW'] = '[\x27|\x22].+[\x27|\x22];?\x20*}';
                };
                f['prototype']['gChoxg'] = function() {
                    var g = new RegExp(this['OvqEvs'] + this['UUyTaW']);
                    var h = true ? --this['vYZdFk'][0x1] : --this['vYZdFk'][0x0];
                    return this['OOqYCd'](h);
                }
                ;
                f['prototype']['OOqYCd'] = function(g) {
                    if (!Boolean(~g)) {
                        return g;
                    }
                    return this['IdtwNC'](this['untziS']);
                }
                ;
                f['prototype']['IdtwNC'] = function(g) {
                    for (var h = 0x0, j = this['vYZdFk']['length']; h < j; h++) {
                        this['vYZdFk']['push'](Math['round'](Math['random']()));
                        j = this['vYZdFk']['length'];
                    }
                    return g(this['vYZdFk'][0x0]);
                }
                ;
                new f($b)['gChoxg']();
                $b['YQUlli'] = !![];
            }
            c = $b['mJVCif'](c, b);
            $b['zBqGxm'][a] = c;
        } else {
            c = d;
        }
        return c;
    };

const ast = parse(js)
traverse(ast,{
    exit:(path) =>{
        if(path.node.extra){
            delete path.node.extra
        }
    }
})
traverse(ast,{
    BinaryExpression:{
        exit:(path) => {
            const {confident,value} = path.evaluate()
            if(confident){
                path.replaceWith(t.valueToNode(value))
            }
        }
    }
})

traverse(ast,{
    CallExpression:{
        exit:(path) => {
            if(t.isIdentifier(path.node.callee) && path.node.callee.name ==='$b'){
                const args = path.get('arguments')
                const result = $b(...args.map(arg => arg.node.value))
                path.replaceWith(t.valueToNode(result))
            }
        }
    }
})

traverse(ast,{
    BinaryExpression:{
        exit:(path) => {
            const {confident,value} = path.evaluate()
            if(confident){
                path.replaceWith(t.valueToNode(value))
            }
        }
    }
})

traverse(ast,{
    ExpressionStatement:{
        exit:(path) => {
            if(t.isMemberExpression(path.node.expression.left) && t.isIdentifier(path.node.expression.left?.object) && path.node.expression.left?.object?.name === 'y' && t.isStringLiteral(path.node.expression.left.property)){
                const scopeBinding = path.scope.getBinding('y')
                const init = scopeBinding.path.get('init')
                if(init?.node){
                    init.node.properties.push(t.objectProperty(t.identifier(path.node.expression.left.property.value),path.node.expression.right))
                    path.remove()
                }
            }
        }
    }
})

fs.writeFileSync('./3ast-output.js',generate(ast).code)